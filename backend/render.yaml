services:
  - type: web
    name: chess-gpt-backend
    env: python
    region: oregon
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      if [ ! -f stockfish ]; then
        echo "Downloading Stockfish..."
        wget -q https://github.com/official-stockfish/Stockfish/releases/download/sf_16/stockfish_16_linux_x64_avx2.zip -O stockfish.zip
        unzip -q stockfish.zip
        chmod +x stockfish_16_linux_x64_avx2/stockfish
        mv stockfish_16_linux_x64_avx2/stockfish ./stockfish
        rm -rf stockfish_16_linux_x64_avx2 stockfish.zip
        echo "Stockfish downloaded and ready"
      fi
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    plan: starter
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: PORT
        value: 10000
