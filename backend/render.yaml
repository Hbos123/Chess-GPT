services:
  - type: web
    name: chess-gpt-backend
    env: python
    region: oregon
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      if [ ! -f stockfish ]; then
        echo "Downloading Stockfish..."
        wget -q https://github.com/official-stockfish/Stockfish/releases/download/sf_16/stockfish-ubuntu-x86-64-avx2.tar -O stockfish.tar
        tar -xf stockfish.tar
        mv stockfish/stockfish-ubuntu-x86-64-avx2 ./stockfish-bin
        rm -rf stockfish stockfish.tar
        mv ./stockfish-bin ./stockfish
        chmod +x ./stockfish
        echo "Stockfish downloaded and ready"
      fi
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    plan: professional
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: PORT
        value: 10000
